package com.tang.model;

import com.google.common.base.Strings;
import com.jfinal.plugin.activerecord.Db;
import com.jfinal.plugin.activerecord.Page;
import com.jfinal.plugin.activerecord.Record;
import com.tang.config.OAConfig;
import com.tang.model.base.BaseTeacher;
import com.tang.util.DateUtils;
import com.tang.util.IDKit;
import com.tang.util.SysConstant;

import java.util.ArrayList;
import java.util.Date;
import java.util.List;

/**
 * Generated by JFinal.
 */
@SuppressWarnings("serial")
public class Teacher extends BaseTeacher<Teacher> {
	public static final Teacher dao = new Teacher();

	/**
	 * 填写教师信息（完善个人信息）
	 * @param userId
	 * @param schoolId
	 * @param collegeId
	 * @param classId
	 * @param bornDate
	 * @param sex
	 * @param name
	 * @return
	 */
	public Boolean saveTeacherInfo(String userId,String schoolId,String collegeId,String classId,Date bornDate,int sex,String name){
		Record teacher = new Record();
		teacher.set("id", IDKit.uuid())
				.set("isDelete", SysConstant.ISDELETE.NO)
				.set("createTime", DateUtils.getCurrentDate())
				.set("updateTime",DateUtils.getCurrentDate())
				.set("teacherName",name)
				.set("sex",sex)
				.set("bornDate",bornDate)
				.set("classId",classId)
				.set("collegeId",collegeId)
				.set("schoolId",schoolId)
				.set("userId", userId);
		Boolean result = Db.save("teacher", teacher);
		return result;
	}

	/**
	 * 获取教师列表
	 * @param teacherName
	 * @param collegeId
	 * @param schoolId
	 * @param classId
	 * @param pageNumber
	 * @param pageSize
	 * @return
	 */
	public Page<Record> queryTeacher(String teacherName,String collegeId,String schoolId,String classId,int pageNumber,int pageSize){
		String select = "SELECT teacher.*,class.className,college.collegeName,school.schoolName";
		StringBuilder sqlExcept = new StringBuilder("FROM teacher,class,college,school " +
				"WHERE teacher.schoolId = ? AND teacher.collegeId = ? " +
				"AND teacher.isDelete = ? AND teacher.classId = class.id ");
		List<Object> paras = new ArrayList<Object>();
		paras.add(schoolId);
		paras.add(collegeId);
		paras.add(SysConstant.ISDELETE.NO);
		if (!Strings.isNullOrEmpty(classId)){
			sqlExcept.append(" AND teacher.classId = ? ");
			paras.add(classId);
		}
		if (!Strings.isNullOrEmpty(teacherName)){
			sqlExcept.append(" AND teacher.teacherName LIKE ? ");
			paras.add("%"+teacherName+"%");
		}
		Page<Record> recordPage = Db.paginate(pageNumber, pageSize, select, sqlExcept.toString(), paras.toArray());
		return recordPage;
	}

}
